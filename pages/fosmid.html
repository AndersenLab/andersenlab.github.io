---
layout: page
title: Fosmid Search
permalink: /fosmid/
---
<div class="row">
	<div class="col-md-12">


<canvas id="gene_glyph" height="330"></canvas>

<form class="form-inline">
  <div class="form-group">
    <label for="fosmid-search">Search</label>
    <input type="text" class="form-control error" id="fosmid-search" placeholder="II:1-100000" value = "I:950000-1000000">
  </div>
</form>

<script>


// Load Fosmid Data
d3.tsv("/distr/fosmid.tsv").get(function(error, d) {
    if (error) throw error;
    d.forEach(function(d) {
      d.Start = parseInt(d.Start);
      d.End = parseInt(d.End);
    });
    data = d;
     
      var table = d3.select("#ftable")
          .append("table")
          .classed("table table-condensed table-striped", true), 
          thead = table.append("thead"),
          tbody = table.append("tbody");

       var hrow = thead.append("tr")
            .selectAll("th")
            .data(Object.keys(data[0]))
            .enter()
            .append("th")
            .text(function(d) { return d; });

    });


    d3.select("#fosmid-search").on("input", function() {
      draw_fosmids(this.value);
    });

function draw_fosmids(i) {
  // Remove existing
      d3.selectAll("#ftable tbody tr").remove();
      if (i.search(":") > 0) {
        i = i.split(":")
        chrom = i[0];
        range = i[1];
        if (range.search("-") > 0) {
          range = range.split("-")
          start = parseInt(range[0].replace(/,/g,""));
          end = parseInt(range[1].replace(/,/g,""));
          if (end > start) {

            filter_results(chrom, start, end);
          }
        }
      }
}    


function filter_results(chrom, start, end) {

    filter_data = data.filter(function(d) {
      if (d["Chromosome"] == chrom && 
            (
              (d["Start"] >= start && d["End"] <= end)
               || 
               (d["Start"] <= start && start <= d["End"])
               || 
               (d["End"] >= end && end >= d["Start"])
            )
         )
         {
        return d
      }
    })

    var rows = d3.select("tbody").selectAll("tr")
      .data(filter_data)
    .enter()
      .append("tr");

    var cells = rows.selectAll("td")
      .data(function(row) {
          return d3.range(Object.keys(row).length).map(function(column, i) {
              return row[Object.keys(row)[i]];
          }); 
      })
    .enter()
      .append("td")
      .text(function(d) { return d; });

   // Draw Gene Glyph
   // Get Canvas and Create Chart

   var canvas = $("#gene_glyph"); 
   var canv_width = canvas.parent().width()

   $("canvas").attr("width", canv_width);
   // Create Chart
   glyph = new Scribl(canvas[0], canv_width);
   glyph.redraw();

   glyph.laneSizes = 18;
   glyph.laneBuffer = 2;
   glyph.scale.min = start;
   glyph.scale.max = end;

   filter_data.forEach(function(d) {
      fosmid = glyph.addFeature( new Rect('gene', d["Start"], d["End"] - d["Start"], "+"));
      fosmid.name = d["Clone"];
      fosmid.color = '#3366FF';
      fosmid.text.color = 'white';
      fosmid.text.font = 'Times New Roman';
   })

   glyph.draw();

   var boundary = document.getElementById("gene_glyph").getContext("2d");
    // Start
    boundary.beginPath();
    boundary.moveTo(glyph.pixelsToNts(start) + glyph.offset - glyph.pixelsToNts(glyph.scale.min), 15);
    boundary.lineTo(glyph.pixelsToNts(start) + glyph.offset - glyph.pixelsToNts(glyph.scale.min), 1000);
    boundary.strokeStyle = "#FF0000";
    boundary.stroke();
    // End
    boundary.beginPath();
    boundary.moveTo(glyph.pixelsToNts(end) + glyph.offset - glyph.pixelsToNts(glyph.scale.min), 15);
    boundary.lineTo(glyph.pixelsToNts(end) + glyph.offset - glyph.pixelsToNts(glyph.scale.min), 1000);
    boundary.strokeStyle = "#FF0000";
    boundary.stroke();

}

// Redraw canvas when the window is resized.
$(window).resize(function() {
    draw_fosmids($("#fosmid-search").val());
});

$( document ).ready(function() {
    draw_fosmids($("#fosmid-search").val())
});






</script>



<div id="ftable">
</div>

  

<br />
<br />
<br />
</div>
</div>

<script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>